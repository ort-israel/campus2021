define ("filter_poodll/msr_plain",["jquery","core/log","filter_poodll/utils_amd"],function(a,b,c){"use strict";b.debug("PoodLL Plain Recorder: initialising");return{timeout:0,mediaRecorder:null,mediaStream:null,audioctx:null,msr:null,mediaType:null,clone:function clone(){return a.extend(!0,{},this)},init:function init(a,b,c,d){this.msr=a;this.mediaStream=b;this.audioctx=c;this.mediaType=d},start:function start(a){var d=this;if(!this.mimeType&&"video"==this.mediaType){this.mimeType="video/webm"}if("audio"==this.mediaType){if(this.mediaStream.getVideoTracks().length&&this.mediaStream.getAudioTracks().length){var e;if(!!navigator.mozGetUserMedia){e=new MediaStream;e.addTrack(this.mediaStream.getAudioTracks()[0])}else{e=new MediaStream(this.mediaStream.getAudioTracks())}this.mediaStream=e}}if("audio"==this.mediaType){this.mimeType=c.is_chrome()?"audio/webm":"audio/ogg"}var f={mimeType:this.mimeType};try{this.mediaRecorder=new MediaRecorder(this.mediaStream,f)}catch(a){this.mediaRecorder=new MediaRecorder(this.mediaStream)}if("canRecordMimeType"in this.mediaRecorder&&!1===this.mediaRecorder.canRecordMimeType(this.mimeType)){b.debug("MediaRecorder API seems unable to record mimeType:"+this.mimeType)}this.mediaRecorder.ignoreMutedMedia=this.ignoreMutedMedia||!1;this.mediaRecorder.ondataavailable=function(a){if(!a.data||!a.data.size){return}var b=d.getNativeBlob?a.data:new Blob([a.data],{type:d.mimeType||"video/webm"});d.msr.ondataavailable(b)};this.mediaRecorder.onerror=function(a){if("InvalidState"===a.name){b.debug("The MediaRecorder is not in a state in which the proposed operation is allowed to be executed.")}else if("OutOfMemory"===a.name){b.debug("The UA has exhaused the available memory. User agents SHOULD provide as much additional information as possible in the message attribute.")}else if("IllegalStreamModification"===a.name){b.debug("A modification to the stream has occurred that makes it impossible to continue recording. An example would be the addition of a Track while recording is occurring. User agents SHOULD provide as much additional information as possible in the message attribute.")}else if("OtherRecordingError"===a.name){b.debug("Used for an fatal error other than those listed above. User agents SHOULD provide as much additional information as possible in the message attribute.")}else if("GenericError"===a.name){b.debug("The UA cannot provide the codec or recording option that has been requested.",a)}else{b.debug("MediaRecorder Error",a)}if(!!d.mediaRecorder&&"inactive"!==d.mediaRecorder.state&&"stopped"!==d.mediaRecorder.state){d.mediaRecorder.stop()}};var g=this.audioctx.createMediaStreamSource(this.mediaStream);g.connect(this.msr.audioanalyser.core);try{d.mediaRecorder.start(a)}catch(a){d.mediaRecorder=null}},stop:function stop(){if(!this.mediaRecorder){return}if("recording"===this.mediaRecorder.state){this.mediaRecorder.stop()}},pause:function pause(){if(!this.mediaRecorder){return}if("recording"===this.mediaRecorder.state){this.mediaRecorder.pause()}},resume:function resume(){if(!this.mediaRecorder){return}if("paused"===this.mediaRecorder.state){this.mediaRecorder.resume()}},clearRecordedData:function clearRecordedData(){if(!this.mediaRecorder){return}this.pause();this.stop()},isMediaStreamActive:function isMediaStreamActive(){if("active"in this.mediaStream){if(!this.mediaStream.active){return!1}}else if("ended"in this.mediaStream){if(this.mediaStream.ended){return!1}}return!0},looper:function looper(){if(!this.mediaRecorder){return}if(!1===this.isMediaStreamActive()){this.stop();return}setTimeout(this.looper,1e3)}}});
//# sourceMappingURL=msr_plain.min.js.map
