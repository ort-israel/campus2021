define(["jquery","//www.geogebra.org/apps/deployggb.js"],function(a,b){return{init:function(){window.GGBT=this,window.ggbAppletOnLoad=function(){if(a('input[name="ggbparameters"]').val(JSON.stringify(window.applet1.getParameters())),a('input[name="ggbviews"]').val(JSON.stringify(window.applet1.getViews())),a('input[name="ggbcodebaseversion"]').val(window.applet1.getHTML5CodebaseVersion()),"undefined"==typeof this.ggbcheckb){var b=document.ggbApplet;a('input[name="ggbxml"]').val(b.getXML()),a('input[name="ggbexercise"]').val(JSON.stringify(b.getExerciseResult()));var c=document.getElementById("id_randomizedvar");c.value||window.GGBT.getrandvars();for(var d=0,e=a("#id_answer_"+d);void 0!==e[0];)e.val()&&(e.on("change focus",function(b){b.preventDefault(),window.GGBT.update_feedback(a(b.target))}),window.GGBT.update_feedback(e)),e=a("#id_answer_"+ ++d);document.querySelector("article").onkeypress=window.GGBT.checkEnter}window.GGBT.usefile.checked&&(document.getElementById("applet_container1").style.display="block",document.getElementById("applet_options").style.display="flex")},void 0!==a("#applet_parameters")[0]&&(this.ggbDataset=a("#applet_parameters")[0].dataset,this.parameters=JSON.parse(this.ggbDataset.parameters),this.views=this.ggbDataset.views,window.applet1=new b(this.parameters,this.views,(!0)),window.applet1.setHTML5Codebase("https://cdn.geogebra.org/apps/5.0.410.0/web3d"),this.lang=this.ggbDataset.lang),a("#id_loadapplet").on("click",function(b){b.preventDefault();var c=a("#id_ggbturl").val().split("/").pop();0==c.indexOf("m")&&(window.GGBT.isNumber(c.substr(1))||!window.GGBT.isNumber(c.substr(1))&&c.length>8)&&(c=c.substr(1)),window.GGBT.injectapplet(c)}),a("#id_getvars").on("click",function(a){a.preventDefault(),window.GGBT.getrandvars()}),this.parameters&&window.applet1.inject("applet_container1","preferHTML5"),this.ggbf=document.getElementById("id_ggbtheader"),this.usefile=document.getElementById("id_usefile"),null===this.ggbf&&(this.ggbf=document.getElementById("id_submissiontypes"),this.ggbcheckb=document.getElementById("id_assignsubmission_geogebra_enabled"),null!==this.ggbcheckb&&this.ggbcheckb.addEventListener("change",this.handleggbdisable,!1)),null!==this.ggbf&&(this.ggbf.addEventListener("dragenter",this.handleDragEnter,!1),this.ggbf.addEventListener("dragover",this.handleDragOver,!1),this.ggbf.addEventListener("dragleave",this.handleDragEndLeave,!1),this.ggbf.addEventListener("dragend",this.handleDragEndLeave,!1),this.ggbf.addEventListener("drop",this.handleDrop,!1),this.usefile.addEventListener("change",this.handleusefile,!1)),this.usefile.checked?document.getElementById("applet_options").style.display="block":document.getElementById("applet_options").style.display="none",this.initoptions()},callback:function(b){var c=M.core_filepicker.instances[b.client_id].options.elementname;a("#id_"+c).val(b.url);var d=b.file.split(".")[0];0==d.indexOf("m")&&(this.isNumber(d.substr(1))||!this.isNumber(d.substr(1))&&d.length>8)&&(d=d.substr(1)),this.injectapplet(d)},injectapplet:function(a){this.parameters={material_id:a},this.parameters.language=this.lang,this.parameters.moodle="editingQuestionOrSubmission",this.parameters.useBrowserForJS=!1,document.getElementById("applet_container1").style.display="block",window.applet1=new b(this.parameters,(!0)),window.applet1.setHTML5Codebase("https://cdn.geogebra.org/apps/5.0.541.0/web3d"),window.applet1.inject("applet_container1","preferHTML5")},getrandvars:function(){var b=document.ggbApplet;if("undefined"!=typeof b)for(var c=b.getObjectNumber(),d=document.getElementById("id_randomizedvar"),e="",f=0,g=0;g<c;g++){var h=b.getObjectName(g);if("numeric"==b.getObjectType(h)&&b.isIndependent(h))e+=h+",";else{var i=a("#id_answer_"+f);"boolean"==b.getObjectType(h)&&null!==i&&(i.val()||i.val(h),this.update_feedback(i),f++)}d.value=e}},update_feedback:function(b){var c=b.attr("id").split("_").pop(),d=b.val(),e=a('input[name="feedback['+c+']"]'),f=a("#id_feedbackfromfile_"+c),g=a.parseXML(window.ggbApplet.getXML(d));if(g){var h=g.getElementsByTagName("caption"),i="";1==h.length?(i=h[0].getAttribute("val"),e.val(i)):h.length>1?(e.val(""),i=""):(e.val(""),i="Caption not set or variable name wrong."),f.val(i)}},checkEnter:function(a){a=a||event;var b=/textarea/i.test((a.target||a.srcElement).tagName);return b||13!==(a.keyCode||a.which||a.charCode||0)},initoptions:function(){this.enable_right_click=document.getElementById("enableRightClick"),this.enable_label_drags=document.getElementById("enableLabelDrags"),this.show_reset_icon=document.getElementById("showResetIcon"),this.enable_shift_drag_zoom=document.getElementById("enableShiftDragZoom"),this.show_algebra_input=document.getElementById("showAlgebraInput"),this.show_menu_bar=document.getElementById("showMenuBar"),this.show_tool_bar=document.getElementById("showToolBar"),"undefined"!=typeof parameters&&(this.enable_right_click.checked=this.parameters.enableRightClick,this.enable_label_drags.checked=this.parameters.enableLabelDrags,this.show_reset_icon.checked=this.parameters.showResetIcon,this.enable_shift_drag_zoom.checked=this.parameters.enableShiftDragZoom,this.show_algebra_input.checked=this.parameters.showAlgebraInput,this.show_menu_bar.checked=this.parameters.showMenuBar,this.show_tool_bar.checked=this.parameters.showToolBar),this.enable_right_click.addEventListener("change",this.handlesettingschanged,!1),this.enable_label_drags.addEventListener("change",this.handlesettingschanged,!1),this.show_reset_icon.addEventListener("change",this.handlesettingschanged,!1),this.enable_shift_drag_zoom.addEventListener("change",this.handlesettingschanged,!1),this.show_algebra_input.addEventListener("change",this.handlesettingschanged,!1),this.show_menu_bar.addEventListener("change",this.handlesettingschanged,!1),this.show_tool_bar.addEventListener("change",this.handlesettingschanged,!1)},handlesettingschanged:function(c){window.GGBT.parameters[c.target.id]=c.target.checked,a('input[name="ggbparameters"]').val(JSON.stringify(window.GGBT.parameters)),"showToolBar"==c.target.id||"showMenuBar"==c.target.id||"showAlgebraInput"==c.target.id?(window.applet1=new b(window.GGBT.parameters,(!0)),window.applet1.setHTML5Codebase("https://cdn.geogebra.org/apps/5.0.541.0/web3d"),window.applet1.inject("applet_container1","preferHTML5")):window.ggbApplet[c.target.id](c.target.checked)},handleusefile:function(){window.GGBT.usefile.checked?document.getElementById("id_ggbturl").value="":(document.getElementById("applet_container1").style.display="none",document.getElementById("applet_options").style.display="none")},handleggbdisable:function(){window.GGBT.ggbcheckb.checked?document.getElementById("applet_container1").style.display="block":(document.getElementById("applet_container1").style.display="none",document.getElementById("applet_options").style.display="none",window.GGBT.usefile.checked&&window.GGBT.usefile.click())},handleDragEnter:function(){("undefined"==typeof ggbcheckb||window.GGBT.ggbcheckb.checked)&&(window.GGBT.ggbf.classList.add("hover"),document.getElementById("applet_container1").style.visibility="hidden")},handleDragOver:function(a){if("undefined"==typeof window.GGBT.ggbcheckb||window.GGBT.ggbcheckb.checked)return a.preventDefault&&a.preventDefault(),window.GGBT.ggbf.classList.add("hover"),document.getElementById("applet_container1").style.visibility="hidden",!1},handleDragEndLeave:function(){("undefined"==typeof window.GGBT.ggbcheckb||window.GGBT.ggbcheckb.checked)&&(window.GGBT.ggbf.classList.remove("hover"),document.getElementById("applet_container1").style.removeProperty("visibility"))},handleDrop:function(a){if("undefined"==typeof window.GGBT.ggbcheckb||window.GGBT.ggbcheckb.checked){a.preventDefault(),a.stopPropagation();var c=a.dataTransfer.files[0];window.GGBT.ggbf.classList.remove("hover"),document.getElementById("applet_container1").style.removeProperty("visibility"),document.getElementById("applet_container1").style.display="block",document.getElementById("applet_options").style.display="flex",document.getElementById("applet_container1").style.height="100%",document.getElementById("id_ggbturl").value="",window.GGBT.usefile.checked||window.GGBT.usefile.click();var d=new FileReader;d.onload=function(a){var c=a.target.result.replace("data:application/vnd.geogebra.file;base64,","");window.GGBT.parameters={ggbBase64:c},window.GGBT.parameters.enableRightClick=window.GGBT.enable_right_click.checked,window.GGBT.parameters.enableLabelDrags=window.GGBT.enable_label_drags.checked,window.GGBT.parameters.showResetIcon=window.GGBT.show_reset_icon.checked,window.GGBT.parameters.enableShiftDragZoom=window.GGBT.enable_shift_drag_zoom.checked,window.GGBT.parameters.showAlgebraInput=window.GGBT.show_algebra_input.checked,window.GGBT.parameters.showMenuBar=window.GGBT.show_menu_bar.checked,window.GGBT.parameters.showToolBar=window.GGBT.show_tool_bar.checked,window.GGBT.parameters.moodle="editingQuestionOrSubmission",window.applet1=new b(window.GGBT.parameters,(!0)),window.applet1.setHTML5Codebase("https://cdn.geogebra.org/apps/5.0.541.0/web3d"),window.applet1.inject("applet_container1")},d.readAsDataURL(c)}},isNumber:function(a){return!isNaN(parseFloat(a))&&isFinite(a)}}});