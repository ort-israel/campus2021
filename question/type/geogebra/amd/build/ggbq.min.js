define(["jquery","//www.geogebra.org/apps/deployggb.js"],function(a,b){return{b64input:[],ggbBase64:[],xmlinput:[],ggbxml:[],currentvals:[],answerinput:[],responsevars:[],exerciseresultinput:[],qdiv:[],ggbDataset:[],init:function(c){window.GGBQ=this;var d=document.getElementById(c).dataset,e=d.slot;window.ggbAppletOnLoad=function(a){if(a!=-1){document.querySelector("article").onkeydown=this.checkEnter;var b=a.substring(9),c=window[a];for(var d in window.GGBQ.currentvals[b])c.setValue(d,window.GGBQ.currentvals[b][d]);window.GGBQ.b64input[b].val(c.getBase64()),window.GGBQ.xmlinput[b].val(c.getXML());var e=c.startExercise();for(var f in e)window.GGBQ.qdiv[b].innerHTML=window.GGBQ.qdiv[b].innerHTML.replace("{"+f+"}",e[f]);if(window.GGBQ.qdiv[b].style.visibility="visible",""==window.GGBQ.answerinput[b].val()){var g="";window.GGBQ.responsevars[b].forEach(function(a){g+=c.isDefined(a)?c.getValue(a):0}),window.GGBQ.answerinput[b].val(g)}}},this.b64input[e]=a(document.getElementById(d.b64input)),this.ggbBase64[e]=this.b64input[e].val(),this.xmlinput[e]=a(document.getElementById(d.xmlinput)),this.ggbxml[e]=this.xmlinput[e].val(),this.qdiv[e]=a("#q"+e+" .qtext")[0];var f=JSON.parse(d.parameters);""!=this.ggbBase64[e]&&(f.ggbBase64=this.ggbBase64[e]),f.language=d.lang,f.moodle="takingQuiz",delete f.material_id,f.id="ggbApplet"+e;var g=JSON.parse(d.views),h=new b(f,g,d.html5NoWebSimple);h.setHTML5Codebase("https://cdn.geogebra.org/apps/5.0.541.0/web3d"),h.inject(d.div,"preferHTML5"),a("#responseform").on("submit",this.getBase64andCheck),a(document.getElementById(d.div)).on("mouseleave",this.getBase64andCheck),this.currentvals[e]=d.vars,this.answerinput[e]=a(document.getElementById(d.answerinput)),this.exerciseresultinput[e]=a(document.getElementById(d.exerciseresultinput)),this.responsevars[e]=JSON.parse(d.responsevars)},checkEnter:function(a){a=a||event;var b=/textarea/i.test((a.target||a.srcElement).tagName);return b||13!==(a.keyCode||a.which||a.charCode||0)},getBase64andCheck:function(){for(var a=0;a<window.GGBQ.answerinput.length;a++){var b=window["ggbApplet"+a];if("undefined"!=typeof b){window.GGBQ.b64input[a].val(b.getBase64()),window.GGBQ.xmlinput[a].val(b.getXML());for(var c="",d=0;d<window.GGBQ.responsevars[a].length;d++)c+=b.isDefined(window.GGBQ.responsevars[a][d])?b.getValue(window.GGBQ.responsevars[a][d]):0;window.GGBQ.answerinput[a].val(c),window.GGBQ.exerciseresultinput[a].val(JSON.stringify(b.getExerciseResult()))}}}}});