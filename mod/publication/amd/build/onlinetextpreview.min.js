define(["jquery","core/modal_factory","core/str","core/ajax","core/log","core/notification"],function(a,b,c,d,e,f){var g=function(){this.cmid=""},h=new g;return h.initializer=function(g){h.cmid=g.cmid,e.info("Initialize onlinetextpreview JS!","mod_publication"),h.modal||(h.modalpromise=b.create({type:b.types.DEFAULT,large:!0})),c.get_strings([{key:"preview",component:"core"},{key:"onlinetextfilename",component:"assignsubmission_onlinetext"},{key:"from",component:"core"}]).done(function(b){e.info("Done loading strings...","mod_publication"),h.modalpromise.done(function(c){e.info("Done preparing modal","mod_publication"),h.modal=c,a(".path-mod-publication table.publications .onlinetextpreview *").click(function(c){c.stopPropagation(),c.preventDefault();var e,g=a(c.target),i=g.parent();try{e=i.data("itemid")}catch(j){f.exception(j)}d.call([{methodname:"mod_publication_get_onlinetextpreview",args:{itemid:e,cmid:h.cmid},done:function(a){var c="";i.data("itemname").length&&(c=" "+b[2].toLowerCase()+" "+i.data("itemname")),h.modal.setTitle(b[0]+" "+b[1]+c),h.modal.setBody(a),h.modal.show()},fail:function(a){f.exception(a)}}])})})}).fail(function(a){e.error("Error getting strings: "+a,"mod_publication")})},h});